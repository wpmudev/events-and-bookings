/*! Events and Bookings - v1.9.9-beta-1
 * http://premium.wpmudev.org/project/events-and-booking
 * Copyright (c) 2018; * Licensed GPLv2+ */

!function(a){function b(){var b=a("#eab-events-fpe-rsvps-wrapper");return b.is(":visible")?b.slideUp("slow"):b.slideDown("slow"),!1}function c(){var b=a("#eab-events-fpe-is_premium");if(!b.val())return!1;var c=a("#eab-events-fpe-event_fee-wrapper");parseInt(b.val())?c.show():c.hide()}function d(b){return a("#eab-events-fpe-date_time-error").length&&a("#eab-events-fpe-date_time-error").remove(),a("#eab-events-fpe-date_time").append('<div id="eab-events-fpe-date_time-error">'+l10nFpe.mising_time_date+"</div>"),!1}function e(b){return a("#eab-events-fpe-date_time-error").length&&a("#eab-events-fpe-date_time-error").remove(),a("#eab-events-fpe-date_time").append('<div id="eab-events-fpe-date_time-error">'+l10nFpe.check_time_date+"</div>"),!1}function f(b,c){var d=c?"eab-events-fpe-error":"eab-events-fpe-success";a(".eab-events-fpe-notification").remove(),a("#eab-events-fpe-ok_cancel").append('<div class="eab-events-fpe-notification '+d+'"><p>'+b+"</p></div>"),setTimeout(function(){a(".eab-events-fpe-notification").slideUp("slow")},2e3)}function g(a){var b=!1;if(a.match(/[ap]m/i)){var c=a.match(/pm/i),d=a.replace(/[ap]m/i,"");b=d.indexOf(":")>=0?d.split(":"):[d,"00"],c&&(b[0]=12+parseInt(b[0],10))}else b=a.indexOf(":")>=0?a.split(":"):[a,"00"];return b||["12","00"]}function h(){a("#eab-events-fpe-date_time-error").length&&a("#eab-events-fpe-date_time-error").remove();var b=!1,c=!1,h=a("#eab-events-fpe-start_date");if(!h.val())return d(h);var i=new Date(h.val()),j=[],k=[];if(a("#eab-events-fpe-toggle_time__start").not(":checked")){var l=a("#eab-events-fpe-start_time");if(!l.val())return d(l);j=g(l.val()),i.setHours(j[0]),i.setMinutes(j[1]),b=!0}var m=a("#eab-events-fpe-end_date");if(!m.val())return d(m);var n=new Date(m.val());if(a("#eab-events-fpe-toggle_time__end").not(":checked")){var o=a("#eab-events-fpe-end_time");if(!o.val())return d(o);k=g(o.val()),n.setHours(k[0]),n.setMinutes(k[1]),c=!0}if((!b&&!c||b&&c)&&i>=n||i>n)return e();a("#eab-events-fpe-ok").after('<img src="'+_eab_events_fpe_data.root_url+'/waiting.gif" id="eab-events-fpe-waiting_indicator" />');var p=a("#eab-events-fpe-content").is(":visible")?a("#eab-events-fpe-content").val():tinyMCE.activeEditor.getContent(),q=[],r=j.join(":"),s=k.join(":");r=r.replace(/ /g,""),s=s.replace(/ /g,""),a('input[name="eab-events-fpe-categories[]"]:checked').each(function(){q.push(a(this).val())});var t={id:a("#eab-events-fpe-event_id").val(),title:a("#eab-events-fpe-event_title").val(),content:p,start:h.val()+" "+r,end:m.val()+" "+s,no_start_time:a("#eab-events-fpe-toggle_time__start").is(":checked"),no_end_time:a("#eab-events-fpe-toggle_time__end").is(":checked"),venue:a("#eab-events-fpe-venue").val(),status:a("#eab-events-fpe-status").val(),is_premium:a("#eab-events-fpe-is_premium").length?a("#eab-events-fpe-is_premium").val():0,category:q,featured:a("#eab-fpe-attach_id").val(),has_start:b,has_end:c};return a("#eab-events-fpe-event_fee").length&&(t.fee=a("#eab-events-fpe-event_fee").val()),a(document).trigger("eab-events-fpe-save_request",[t]),a.post(_eab_events_fpe_data.ajax_url,{action:"eab_events_fpe-save_event",data:t},function(b){a("#eab-events-fpe-waiting_indicator").remove();var c=!1,d=!1;try{c=parseInt(b.status,10)}catch(a){c=0}try{d=b.message}catch(a){d=!1}if(!c)return f(d||l10nFpe.general_error,!0);var e=!1;try{e=parseInt(b.post_id,10)}catch(a){e=0}if(!e)return f(d||l10nFpe.missing_id,!0);var g=!1;try{g=b.permalink}catch(a){g=!1}return g&&(a("#eab-events-fpe-back_to_event").attr("href",g).show(),a("#eab-events-fpe-cancel").off("click").on("click",function(){window.location=g}).show()),a("#eab-events-fpe-event_id").val(e),a(".eab-attendance-event_id").val(e),f(d||l10nFpe.all_good,!1)}),!1}jQuery(document).ready(function(a){jQuery(document).on("change","#incsub_event_no_start_time_0",function(){1==document.getElementById("incsub_event_no_start_time_0").checked?jQuery("#eab-events-fpe-start_time").hide():jQuery("#eab-events-fpe-start_time").show()}),jQuery(document).on("change","#incsub_event_no_end_time_0",function(){1==document.getElementById("incsub_event_no_end_time_0").checked?jQuery("#eab-events-fpe-end_time").hide():jQuery("#eab-events-fpe-end_time").show()}),"00:00"==jQuery("#eab-events-fpe-start_time").val()&&(jQuery(".eab-events-fpe_wrap_time_start ").hide(),jQuery("#eab-events-fpe-toggle_time__start").attr("checked",!0)),"00:00"==jQuery("#eab-events-fpe-end_time").val()&&(jQuery(".eab-events-fpe_wrap_time_end").hide(),jQuery("#eab-events-fpe-toggle_time__end").attr("checked",!0))}),a(function(){a("#fpe-editor").append(a("#fpe-editor-root")),a("#fpe-editor-root").show(),a("#eab-events-fpe-toggle_rsvps").click(b),a("#eab-events-fpe-start_date, #eab-events-fpe-end_date").datepicker({minDate:0,dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),a("#eab-events-fpe-is_premium")&&(a("#eab-events-fpe-is_premium").change(c),c()),a("body").on("click",".eab-add_attendance .button",function(){var b=a(".eab-add_attendance"),c=b.find(".eab-attendance-event_id").val();return email=b.find(".eab-attendance-email").val(),status=b.find(".eab-attendance-status").val(),!!(c&&email&&status)&&(a.post(ajaxurl,{action:"eab_add_attendance",user:email,post_id:c,status:status},function(b){a(".eab-add_attendance-container").html(b)}),!1)}),a("body").on("click",".eab-guest-delete_attendance",function(){var b=a(this),c=b.attr("data-eab-user_id"),d=b.attr("data-eab-event_id");return a.post(ajaxurl,{action:"eab_delete_attendance",user_id:c,post_id:d},function(b){a(".eab-add_attendance-container").html(b),window.location.reload()}),!1}),a("body").on("click",".eab-guest-cancel_attendance",function(){var b=a(this),c=b.attr("data-eab-user_id"),d=b.attr("data-eab-event_id");return a.post(ajaxurl,{action:"eab_cancel_attendance",user_id:c,post_id:d},function(b){a(".eab-add_attendance-container").html(b),window.location.reload()}),!1}),a("#eab-events-fpe-ok").click(h);var d=a("#eab-events-fpe-back_to_event").is(":visible")&&a("#eab-events-fpe-back_to_event").attr("href");d?a("#eab-events-fpe-cancel").off("click").on("click",function(){window.location=d}).show():a("#eab-events-fpe-cancel").hide(),a(".eab-fpe-upload").click(function(){var b=window.send_to_editor;return tb_show("&nbsp;",l10nFpe.base_url+"/wp-admin/media-upload.php?type=image&TB_iframe=true&post_id=0",!1),window.send_to_editor=function(c){var d=c.split("wp-image-")[1].split('"')[0];a("#eab-fpe-attach_id").val(d);var e=a("img",c).attr("src");a("#eab-fpe-preview-upload").attr("src",e).show(),tb_remove(),window.send_to_editor=b},!1}),a(document).on("click","#eab-events-fpe-date_time .eab_time_toggle",function(){var b=a(this).data("time-affect"),c="checkbox"==a(this).attr("type")?"checkbox":"other_trigger",d=a(".eab-events-fpe_wrap_time_"+b),e=a("#eab-events-fpe-toggle_time__"+b);"other_trigger"==c&&e.prop("checked",!e.prop("checked")),e.is(":checked")?d.fadeOut(300):d.show(300)})})}(jQuery);